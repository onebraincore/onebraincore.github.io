(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[910],{4313:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/chatterbox",function(){return s(2154)}])},9852:function(e,t,s){"use strict";var n=s(5893);s(7294);let a=e=>{let{children:t}=e;return(0,n.jsx)("header",{children:t})};t.Z=a},2154:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return V}});var n=s(5893),a=s(7294),l=s(9008),o=s.n(l),r=s(1664),i=s.n(r),c=s(5675),d=s.n(c),h=s(1163),u=s(2286),p=s(9852);let g=e=>{setTimeout(()=>(e.isReady&&setTimeout(()=>{e.push("/signin",void 0,{shallow:!1})},20),console.log("Unauthorized error"),Promise.reject("Unauthorized")),20)},m=()=>{let[e,t]=(0,a.useState)({isMobile:!1});return(0,a.useEffect)(()=>{let e=()=>{let e=window.matchMedia("(max-width: 768px)").matches;t({isMobile:e})};return window.addEventListener("resize",e),e(),()=>window.removeEventListener("resize",e)},[]),e},x=()=>{"undefined"!=typeof document&&(0,u.setCookie)(null,"access_token","",{maxAge:-1,path:"/"})},v=e=>{let{children:t,headTitle:s}=e,l=(0,h.useRouter)(),r=()=>{x(),l.isReady&&setTimeout(()=>{l.push("/signin",void 0,{shallow:!1})},20)},{isMobile:c}=m();return(0,n.jsxs)(a.Fragment,{children:[(0,n.jsxs)(o(),{children:[(0,n.jsx)("title",{children:s}),(0,n.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),(0,n.jsx)("link",{rel:"stylesheet",href:"/styles/htmlblackfix.css"})]}),(0,n.jsx)(p.Z,{children:(0,n.jsx)("div",{className:"container p-4-top onebrainapp",style:{display:"".concat(c?"none":"")},children:(0,n.jsx)("div",{className:"row-ordered",children:(0,n.jsxs)("div",{className:" col-lg-12 col-md-12 col-sm-12 col-xs-12 text-center",children:[(0,n.jsx)(i(),{href:"/",children:(0,n.jsxs)("div",{className:"brain-logo-sm",children:[(0,n.jsx)(d(),{src:"/brain-itself.gif",alt:"OneBrain logo",width:34,height:34}),(0,n.jsxs)("div",{className:"d-inline brand-name align-middle",children:[(0,n.jsx)("div",{className:"d-inline blue-gradient-brand-name",children:"One"}),(0,n.jsx)("div",{className:"d-inline violet-gradient-brand-name",children:"Brain"})]})]})}),(0,n.jsx)("div",{className:"d-inline absolute right-0 top-0",children:(0,n.jsx)(i(),{href:"#",children:(0,n.jsx)("span",{className:"book-a-call",onClick:r,children:"Log Out"})})})]})})})}),(0,n.jsx)("div",{className:"".concat(c?"mobile":"desktop"),children:t})]})};v.defaultProps={headTitle:"OneBrain AI"};var f=s(2664),j=s(7814);s(3119);var w=s(9417);let y=e=>({type:"SET_CHATID",payload:e});var E=s(6486);let N=(0,n.jsx)(j.G,{icon:w.lXL,size:"sm",style:{color:"#A2A2A5"}}),k=(0,n.jsx)(j.G,{icon:w.IwR,size:"sm",className:"pen-edit-icon"}),_=(0,n.jsx)(j.G,{icon:w.Vui,size:"sm",className:"pen-trash-icon"}),C=(0,n.jsx)(j.G,{icon:w.r8p,size:"sm",className:"icon"}),A=e=>{let{toggleChanges:t}=e,s=(0,h.useRouter)(),[l,o]=(0,a.useState)([]),[r,i]=(0,a.useState)({}),c=(0,f.I0)(),d=(0,f.v9)(e=>e.changes_toggle),p=(0,f.v9)(e=>e.chat_id);console.log("fetching server");let m=async()=>{let e=new Headers,t=(0,u.parseCookies)(),n=t.access_token;e.append("Content-Type","application/json"),e.append("Authorization","Bearer ".concat(n));try{let t=await fetch("http://127.0.0.1:8080/chat/titles",{method:"GET",headers:e,redirect:"follow"}),s=await t.json();o(s)}catch(e){e instanceof Error&&"401"===e.message?(console.log("Unauthorized error occurred"),g(s)):console.log("Error:",e)}console.log("fetching end")},x=e=>{let t={};return Array.isArray(e)&&e.forEach(e=>{t[e.id]=e.id}),t},v=(e,t)=>{(0,E.isEqual)(r,e)||t(e)};(0,a.useEffect)(()=>{m(),console.log("TOGGGGLLLLE");let e=x(l);v(e,e=>{})},[d]);let j=e=>{let n=(0,u.parseCookies)(),a=n.access_token,l=new Headers;l.append("Content-Type","application/json"),l.append("Authorization","Bearer ".concat(a)),fetch("http://127.0.0.1:8080/chat/delete?id=".concat(e),{method:"GET",headers:l,redirect:"follow"}).then(e=>{if(!e.ok)throw Error(e.status.toString());return e.text()}).then(e=>{console.log(e),t(),c(y(null))}).catch(e=>{e instanceof Error&&"401"===e.message?(console.log("Unauthorized error occurred"),g(s)):console.log("Error:",e)})},w=()=>{let e=document.querySelector("#chat-input");e&&e.focus(),c(y(null))},A=(()=>{let e={last7Days:[],last30Days:[],lastYear:[]},t=new Date,s=new Date(t);s.setDate(s.getDate()-7);let n=new Date(t);n.setDate(n.getDate()-30);let a=new Date(t);return a.setFullYear(a.getFullYear()-1),Array.isArray(l)&&l.forEach(l=>{let o=new Date(l.createdat);o>=s?e.last7Days.push(l):o>=n&&o<=t?e.last30Days.push(l):o>=a&&o<=t&&e.lastYear.push(l)}),e})(),T=e=>{var t,s;let n=null===(t=e.currentTarget.closest(".old-chat"))||void 0===t?void 0:t.querySelector("input");if(e.stopPropagation(),n){n.focus();let e=null===(s=n.closest(".old-chat"))||void 0===s?void 0:s.querySelector(".delete-edit-hover");e&&(e.style.display="none")}},b=async e=>{try{j(e)}catch(e){console.log("Error occurred while deleting chat:",e)}},z=(e,t)=>{var s;null===(s=e.currentTarget.closest(".old-chat"))||void 0===s||s.querySelector("input"),e.stopPropagation(),b(t)},S=(e,t)=>{var s;let n=null===(s=e.currentTarget.closest(".old-chat"))||void 0===s?void 0:s.querySelector(".delete-edit-hover");n&&(n.style.display="block");let a=e.currentTarget.value,l=r[t];if(a!==l){let e=(0,u.parseCookies)(),s=e.access_token,n=new Headers;n.append("Content-Type","application/json"),n.append("Authorization","Bearer ".concat(s));let l=JSON.stringify({id:t,title:a});fetch("http://127.0.0.1:8080/chat/edit_title",{method:"POST",headers:n,body:l,redirect:"follow"}).then(e=>e.text()).then(e=>console.log(e)).catch(e=>console.log("error",e))}"Enter"===e.key&&e.currentTarget.blur()},D=(e,t)=>{t.stopPropagation(),console.log("Clicked on delete/edit with chatId:",e),c(y(e))};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"new-chat ".concat(null===p?"active":""),onClick:w,children:[C,"New chat"]}),(0,n.jsxs)("div",{className:"chat-nav-records",children:[(0,n.jsxs)("div",{className:"timeblock",children:[(0,n.jsx)("div",{className:"timestamp text-left",children:"Last 7 days"}),A.last7Days.map(e=>(0,n.jsxs)("div",{className:"old-chat ".concat(p===e.id?"active":""),children:[(0,n.jsx)("input",{type:"text",defaultValue:e.title,onBlur:t=>S(t,e.id),onKeyDown:t=>{"Enter"===t.key&&S(t,e.id)}}),N,(0,n.jsxs)("div",{className:"delete-edit-hover",onClick:t=>D(e.id,t),children:[(0,n.jsx)("div",{className:"wrapping",onClick:e=>T(e),children:k}),(0,n.jsx)("div",{className:"wrapping",onClick:t=>z(t,e.id),children:_})]})]},e.id))]}),(0,n.jsxs)("div",{className:"timeblock",children:[(0,n.jsx)("div",{className:"timestamp text-left",children:"Last 30 days"}),A.last30Days.map(e=>(0,n.jsxs)("div",{className:"old-chat",children:[(0,n.jsx)("input",{type:"text",defaultValue:e.title,onBlur:t=>S(t,e.id),onKeyDown:t=>{"Enter"===t.key&&S(t,e.id)}}),N,(0,n.jsxs)("div",{className:"delete-edit-hover",onClick:t=>D(e.id,t),children:[(0,n.jsx)("div",{className:"wrapping",id:"editTitle",onClick:e=>T(e),children:k}),_]})]},e._id))]}),(0,n.jsxs)("div",{className:"timeblock",children:[(0,n.jsx)("div",{className:"timestamp text-left",children:"Last year"}),A.lastYear.map(e=>(0,n.jsxs)("div",{className:"old-chat",children:[(0,n.jsx)("input",{type:"text",defaultValue:e.title,onBlur:t=>S(t,e.id),onKeyDown:t=>{"Enter"===t.key&&S(t,e.id)}}),N," ",e.title,(0,n.jsxs)("div",{className:"delete-edit-hover",onClick:t=>D(e.id,t),children:[(0,n.jsx)("div",{className:"wrapping",id:"editTitle",onClick:e=>T(e),children:k}),_]})]},e._id))]})]})]})},T=e=>({changes_toggle:e.changes_toggle}),b=e=>({toggleChanges:()=>e({type:"TOGGLE_CHANGES"})});var z=(0,f.$j)(T,b)(A);let S=()=>(0,n.jsxs)("div",{className:"select-app-container",children:[(0,n.jsx)(d(),{src:"/demoApp/selectApps/g-drive.png",alt:"OneBrain logo",width:187,height:156}),(0,n.jsx)(d(),{src:"/demoApp/selectApps/slack.png",alt:"OneBrain logo",width:187,height:156}),(0,n.jsx)(d(),{src:"/demoApp/selectApps/add-app.png",alt:"OneBrain logo",width:187,height:156})]});var D=s(8356),O=s(8500);let B={chat_id:null,changes_toggle:!1},G=(0,D.MT)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_CHATID":return{...e,chat_id:t.payload};case"TOGGLE_CHANGES":return{...e,changes_toggle:!e.changes_toggle};default:return e}},(0,O.Uo)((0,D.md)())),L=()=>{let[e,t]=(0,a.useState)(!1),s=()=>{t(!e)};return(0,n.jsxs)("div",{className:"chat-navigation",children:[(0,n.jsx)("div",{className:"app-select-switcher text-left",children:(0,n.jsx)(d(),{src:e?"/toggleAppSel.png":"/toggleConv.png",alt:"OneBrain logo",width:40,height:40,onClick:s})}),e?(0,n.jsx)(S,{}):(0,n.jsx)(f.zt,{store:G,children:(0,n.jsx)(z,{})})]})},H=()=>{let e=(0,h.useRouter)(),t=(0,f.v9)(e=>e.chat_id),[s,l]=(0,a.useState)(null),o=(0,f.v9)(e=>e.changes_toggle),r=(0,u.parseCookies)(),i=r.access_token,c=async()=>{try{let e=await fetch("http://127.0.0.1:8080/chat/specific?chatid=".concat(t),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(i)},redirect:"follow"});if(e.ok){let t=await e.json();l(t),console.log(t)}else if(401===e.status)throw Error("Unauthorized");else throw Error("Network response was not OK")}catch(t){console.log("Error:",t),t instanceof Error&&"Unauthorized"===t.message?(console.log("Unauthorized error occurred"),g(e)):console.log("Error:",t)}};(0,a.useEffect)(()=>{t?(console.log("chatID"),console.log(t),c()):l(null)},[t,o]);let{isMobile:d}=m();return(0,n.jsx)(a.Fragment,{children:(0,n.jsx)("div",{className:"chat-screen ".concat(d?"mobile":"desktop"),children:s&&s.UserQuestions&&s.MachineAnswers&&(0,n.jsx)(a.Fragment,{children:s.UserQuestions.map((e,t)=>(0,n.jsxs)(a.Fragment,{children:[(0,n.jsx)("div",{className:"question",children:e}),(0,n.jsx)("div",{className:"answer",children:s.MachineAnswers[t]})]},t))})})})},U=()=>{if("undefined"!=typeof document){let e=document.getElementsByTagName("textarea");document.getElementById("refresh-input");for(let t=0;t<e.length;t++)e[t].setAttribute("style","height:"+(50+e[t].scrollHeight-50)+"px;overflow:auto;"),e[t].addEventListener("input",I,!1)}},I=e=>{console.log("input");let t=document.getElementById("refresh-input");e.target.style.height=0,e.target.style.height=10+e.target.scrollHeight+"px",10+e.target.scrollHeight<240&&(t.style.top=-10-e.target.scrollHeight+"px")},P=()=>{let e=document.getElementById("chat-input");e&&(e.value=""),I({target:e})},M=e=>{let{changes_toggle:t,toggleChanges:s}=e,l=(0,f.v9)(e=>e.chat_id),o=(0,a.useRef)(null),r=(0,h.useRouter)(),[i,c]=(0,a.useState)("");(0,a.useEffect)(()=>{U();let e=e=>{console.log("Route change complete.")};return r.events.on("routeChangeComplete",e),()=>{r.events.off("routeChangeComplete",e)}},[r]),(0,a.useEffect)(()=>{P()},[]);let p=()=>{let e=(0,u.parseCookies)(),t=e.access_token,n=new Headers;n.append("Content-Type","application/json"),n.append("Authorization","Bearer ".concat(t));let a=JSON.stringify({title:"title",UserQuestions:i,MachineAnswers:"answer"});fetch("http://127.0.0.1:8080/chat/create",{method:"POST",headers:n,body:a,redirect:"follow"}).then(e=>e.text()).then(e=>{console.log(e),s()}).catch(e=>{e instanceof Error&&"401"===e.message?(console.log("Unauthorized error occurred"),g(r)):console.log("Error:",e)})},m=async()=>{let e=(0,u.parseCookies)(),t=e.access_token,n=new Headers;n.append("Content-Type","application/json"),n.append("Authorization","Bearer ".concat(t));let a=JSON.stringify({id:l,title:"test2",UserQuestions:i,MachineAnswers:"machine_answers"});try{let e=await fetch("http://127.0.0.1:8080/chat/append",{method:"POST",headers:n,body:a,redirect:"follow"});await e.json(),s()}catch(e){e instanceof Error&&"401"===e.message?(console.log("Unauthorized error occurred"),g(r)):console.log("Error:",e)}console.log("fetching end")},x=e=>{e.stopPropagation(),""!==i.trim()&&(null===l?p():m(),c(""),P()),console.log("chatId"),console.log(l)};return(0,n.jsxs)("div",{className:"chat-input",children:[(0,n.jsxs)("div",{className:"refresh-input",id:"refresh-input",children:[(0,n.jsx)(j.G,{icon:w.lXL,size:"sm",style:{color:"#A2A2A5"}}),"Regenerate response"]}),(0,n.jsxs)("div",{className:"add-input",children:[(0,n.jsx)("textarea",{ref:o,id:"chat-input",placeholder:"Ask anything you need...",value:i,onChange:e=>c(e.target.value),onKeyDown:e=>{if("Enter"===e.key)return e.preventDefault(),x(e),!1}}),(0,n.jsx)(d(),{src:"/demoApp/paper-plane.png",alt:"OneBrain logo",width:38,height:38,onClick:e=>x(e)})]})]})},R=e=>({changes_toggle:e.changes_toggle}),F=e=>({toggleChanges:()=>e({type:"TOGGLE_CHANGES"})});var q=(0,f.$j)(R,F)(M);let K=e=>(0,n.jsx)(a.Fragment,{children:(0,n.jsxs)(f.zt,{store:G,children:[(0,n.jsx)(H,{}),(0,n.jsx)(q,{})]})});console.log("chatterbox");let Y=()=>{let[e,t]=(0,a.useState)({isMobile:!1});return(0,a.useEffect)(()=>{let e=()=>{let e=window.matchMedia("(max-width: 768px)").matches;t({isMobile:e})};return window.addEventListener("resize",e),e(),()=>window.removeEventListener("resize",e)},[]),e},Q=()=>{let{isMobile:e}=Y();return(0,n.jsxs)(v,{children:[(0,n.jsx)("h1",{children:e?"Mobile":"Desktop"}),(0,n.jsx)(L,{}),(0,n.jsx)(K,{})]})};var V=Q}},function(e){e.O(0,[976,662,675,636,279,774,888,179],function(){return e(e.s=4313)}),_N_E=e.O()}]);