(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[910],{4313:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/chatterbox",function(){return s(2154)}])},9852:function(e,t,s){"use strict";var n=s(5893);s(7294);let l=e=>{let{children:t}=e;return(0,n.jsx)("header",{children:t})};t.Z=l},2154:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return Q}});var n=s(5893),l=s(7294),o=s(9008),a=s.n(o),r=s(1664),i=s.n(r),c=s(5675),d=s.n(c),h=s(1163),g=s(2286),p=s(9852);let u=e=>{setTimeout(()=>(e.isReady&&setTimeout(()=>{e.push("/signin",void 0,{shallow:!1})},20),console.log("Unauthorized error"),Promise.reject("Unauthorized")),20)},m=()=>{let[e,t]=(0,l.useState)({isMobile:!1});return(0,l.useEffect)(()=>{let e=()=>{let e=window.matchMedia("(max-width: 768px)").matches;t({isMobile:e})};return window.addEventListener("resize",e),e(),()=>window.removeEventListener("resize",e)},[]),e},x=()=>{"undefined"!=typeof document&&(0,g.setCookie)(null,"access_token","",{maxAge:-1,path:"/"})},j=e=>{let{children:t,headTitle:s}=e,o=(0,h.useRouter)(),r=()=>{x(),o.isReady&&setTimeout(()=>{o.push("/signin",void 0,{shallow:!1})},20)},{isMobile:c}=m();return(0,n.jsxs)(l.Fragment,{children:[(0,n.jsxs)(a(),{children:[(0,n.jsx)("title",{children:s}),(0,n.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),(0,n.jsx)("link",{rel:"stylesheet",href:"/styles/htmlblackfix.css"})]}),(0,n.jsxs)(p.Z,{children:[(0,n.jsx)("div",{className:"container p-4-top onebrainapp",style:{display:"".concat(c?"none":"")},children:(0,n.jsx)("div",{className:"row-ordered",children:(0,n.jsxs)("div",{className:" col-lg-12 col-md-12 col-sm-12 col-xs-12 text-center",children:[(0,n.jsx)(i(),{href:"/",children:(0,n.jsxs)("div",{className:"brain-logo-sm",children:[(0,n.jsx)(d(),{src:"/brain-itself.gif",alt:"OneBrain logo",width:34,height:34}),(0,n.jsxs)("div",{className:"d-inline brand-name align-middle",children:[(0,n.jsx)("div",{className:"d-inline blue-gradient-brand-name",children:"One"}),(0,n.jsx)("div",{className:"d-inline violet-gradient-brand-name",children:"Brain"})]})]})}),(0,n.jsx)("div",{className:"d-inline absolute right-0 top-0",children:(0,n.jsx)(i(),{href:"#",children:(0,n.jsx)("span",{className:"book-a-call",onClick:r,children:"Log Out"})})})]})})}),c?(0,n.jsx)("div",{className:"logout-mobile",onClick:r,children:"Log out"}):""]}),(0,n.jsx)("div",{className:"".concat(c?"mobile":"desktop"),children:t})]})};j.defaultProps={headTitle:"OneBrain AI"};var v=s(2664),f=s(7814);s(3119);var y=s(9417);let w=e=>({type:"SET_CHATID",payload:e});var N=s(6486);let k=(0,n.jsx)(f.G,{icon:y.lXL,size:"sm",style:{color:"#A2A2A5"}}),E=(0,n.jsx)(f.G,{icon:y.IwR,size:"sm",className:"pen-edit-icon"}),C=(0,n.jsx)(f.G,{icon:y.Vui,size:"sm",className:"pen-trash-icon"}),_=(0,n.jsx)(f.G,{icon:y.r8p,size:"sm",className:"icon"}),A=e=>{let{toggleChanges:t}=e,s=(0,h.useRouter)(),[o,a]=(0,l.useState)([]),[r,i]=(0,l.useState)({}),c=(0,v.I0)(),d=(0,v.v9)(e=>e.changes_toggle),p=(0,v.v9)(e=>e.chat_id);console.log("fetching server");let m=async()=>{let e=new Headers,t=(0,g.parseCookies)(),n=t.access_token;e.append("Content-Type","application/json"),e.append("Authorization","Bearer ".concat(n));try{let t=await fetch("http://127.0.0.1:8080/chat/titles",{method:"GET",headers:e,redirect:"follow"}),s=await t.json();a(s)}catch(e){e instanceof Error&&"401"===e.message?(console.log("Unauthorized error occurred"),u(s)):console.log("Error:",e)}console.log("fetching end")},x=e=>{let t={};return Array.isArray(e)&&e.forEach(e=>{t[e.id]=e.id}),t},j=(e,t)=>{(0,N.isEqual)(r,e)||t(e)};(0,l.useEffect)(()=>{m(),console.log("TOGGGGLLLLE");let e=x(o);j(e,e=>{})},[d]);let f=e=>{let n=(0,g.parseCookies)(),l=n.access_token,o=new Headers;o.append("Content-Type","application/json"),o.append("Authorization","Bearer ".concat(l)),fetch("http://127.0.0.1:8080/chat/delete?id=".concat(e),{method:"GET",headers:o,redirect:"follow"}).then(e=>{if(!e.ok)throw Error(e.status.toString());return e.text()}).then(e=>{console.log(e),t(),c(w(null))}).catch(e=>{e instanceof Error&&"401"===e.message?(console.log("Unauthorized error occurred"),u(s)):console.log("Error:",e)})},y=()=>{let e=document.querySelector("#chat-input");e&&e.focus(),c(w(null))},A=(()=>{let e={last7Days:[],last30Days:[],lastYear:[]},t=new Date,s=new Date(t);s.setDate(s.getDate()-7);let n=new Date(t);n.setDate(n.getDate()-30);let l=new Date(t);return l.setFullYear(l.getFullYear()-1),Array.isArray(o)&&o.forEach(o=>{let a=new Date(o.createdat);a>=s?e.last7Days.push(o):a>=n&&a<=t?e.last30Days.push(o):a>=l&&a<=t&&e.lastYear.push(o)}),e})(),S=e=>{var t,s;let n=null===(t=e.currentTarget.closest(".old-chat"))||void 0===t?void 0:t.querySelector("input");if(e.stopPropagation(),n){n.focus();let e=null===(s=n.closest(".old-chat"))||void 0===s?void 0:s.querySelector(".delete-edit-hover");e&&(e.style.display="none")}},T=async e=>{try{f(e)}catch(e){console.log("Error occurred while deleting chat:",e)}},b=(e,t)=>{var s;null===(s=e.currentTarget.closest(".old-chat"))||void 0===s||s.querySelector("input"),e.stopPropagation(),T(t)},z=(e,t)=>{var s;let n=null===(s=e.currentTarget.closest(".old-chat"))||void 0===s?void 0:s.querySelector(".delete-edit-hover");n&&(n.style.display="block");let l=e.currentTarget.value,o=r[t];if(l!==o){let e=(0,g.parseCookies)(),s=e.access_token,n=new Headers;n.append("Content-Type","application/json"),n.append("Authorization","Bearer ".concat(s));let o=JSON.stringify({id:t,title:l});fetch("http://127.0.0.1:8080/chat/edit_title",{method:"POST",headers:n,body:o,redirect:"follow"}).then(e=>e.text()).then(e=>console.log(e)).catch(e=>console.log("error",e))}"Enter"===e.key&&e.currentTarget.blur()},L=(e,t)=>{t.stopPropagation(),console.log("Clicked on delete/edit with chatId:",e),c(w(e))};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"new-chat ".concat(null===p?"active":""),onClick:y,children:[_,"New chat"]}),(0,n.jsxs)("div",{className:"chat-nav-records",children:[(0,n.jsxs)("div",{className:"timeblock",children:[(0,n.jsx)("div",{className:"timestamp text-left",children:"Last 7 days"}),A.last7Days.map(e=>(0,n.jsxs)("div",{className:"old-chat ".concat(p===e.id?"active":""),children:[(0,n.jsx)("input",{type:"text",defaultValue:e.title,onBlur:t=>z(t,e.id),onKeyDown:t=>{"Enter"===t.key&&z(t,e.id)}}),k,(0,n.jsxs)("div",{className:"delete-edit-hover",onClick:t=>L(e.id,t),children:[(0,n.jsx)("div",{className:"wrapping",onClick:e=>S(e),children:E}),(0,n.jsx)("div",{className:"wrapping",onClick:t=>b(t,e.id),children:C})]})]},e.id))]}),(0,n.jsxs)("div",{className:"timeblock",children:[(0,n.jsx)("div",{className:"timestamp text-left",children:"Last 30 days"}),A.last30Days.map(e=>(0,n.jsxs)("div",{className:"old-chat",children:[(0,n.jsx)("input",{type:"text",defaultValue:e.title,onBlur:t=>z(t,e.id),onKeyDown:t=>{"Enter"===t.key&&z(t,e.id)}}),k,(0,n.jsxs)("div",{className:"delete-edit-hover",onClick:t=>L(e.id,t),children:[(0,n.jsx)("div",{className:"wrapping",id:"editTitle",onClick:e=>S(e),children:E}),C]})]},e._id))]}),(0,n.jsxs)("div",{className:"timeblock",children:[(0,n.jsx)("div",{className:"timestamp text-left",children:"Last year"}),A.lastYear.map(e=>(0,n.jsxs)("div",{className:"old-chat",children:[(0,n.jsx)("input",{type:"text",defaultValue:e.title,onBlur:t=>z(t,e.id),onKeyDown:t=>{"Enter"===t.key&&z(t,e.id)}}),k," ",e.title,(0,n.jsxs)("div",{className:"delete-edit-hover",onClick:t=>L(e.id,t),children:[(0,n.jsx)("div",{className:"wrapping",id:"editTitle",onClick:e=>S(e),children:E}),C]})]},e._id))]})]})]})},S=e=>({changes_toggle:e.changes_toggle}),T=e=>({toggleChanges:()=>e({type:"TOGGLE_CHANGES"})});var b=(0,v.$j)(S,T)(A);let z=()=>(0,n.jsxs)("div",{className:"select-app-container",children:[(0,n.jsx)(d(),{src:"/demoApp/selectApps/g-drive.png",alt:"OneBrain logo",width:187,height:156}),(0,n.jsx)(d(),{src:"/demoApp/selectApps/slack.png",alt:"OneBrain logo",width:187,height:156}),(0,n.jsx)(d(),{src:"/demoApp/selectApps/add-app.png",alt:"OneBrain logo",width:187,height:156})]});var L=s(8356),O=s(8500);let D={chat_id:null,changes_toggle:!1},B=(0,L.MT)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_CHATID":return{...e,chat_id:t.payload};case"TOGGLE_CHANGES":return{...e,changes_toggle:!e.changes_toggle};default:return e}},(0,O.Uo)((0,L.md)())),G=()=>{let[e,t]=(0,l.useState)(!1),[s,o]=(0,l.useState)(!1),[a,r]=(0,l.useState)(!1),{isMobile:i}=m(),c=()=>{t(!e)},h=()=>{if(!a){let e=document.querySelector("#chat-screen"),t=document.querySelector("#input-container"),n=document.querySelector("#refresh-input"),l=document.querySelector("#chat-input");e&&(e.classList.toggle("hidden"),n.classList.toggle("hidden"),l.classList.toggle("hidden"),t.classList.toggle("hidden")),o(!s)}},g=()=>{if(!s){let e=document.querySelector("#chat-screen"),t=document.querySelector("#input-container"),s=document.querySelector("#refresh-input"),n=document.querySelector("#chat-input");e&&(e.classList.toggle("hidden"),s.classList.toggle("hidden"),n.classList.toggle("hidden"),t.classList.toggle("hidden")),r(!a)}};return(0,n.jsxs)("div",{className:"chat-navigation",style:!i||s||a?{}:{top:"auto",height:"110px",bottom:"-40px",paddingTop:"0px",zIndex:1},children:[(0,n.jsx)("div",{className:"app-select-switcher text-left",children:(0,n.jsx)(d(),{src:e?"/toggleAppSel.png":"/toggleConv.png",alt:"OneBrain logo",width:40,height:40,onClick:c})}),e&&!i?(0,n.jsx)(z,{}):e||i?!s&&a&&i?(0,n.jsx)(z,{}):!a&&s&&i?(0,n.jsx)(v.zt,{store:B,children:(0,n.jsx)(b,{})}):i?(0,n.jsx)("div",{style:{backgroundColor:"black"}}):(0,n.jsx)(z,{}):(0,n.jsx)(v.zt,{store:B,children:(0,n.jsx)(b,{})}),(0,n.jsx)("div",{className:"chat-records-switcher-bottom text-left",children:(0,n.jsx)(d(),{src:s?"/toggleAppSelClose.png":"/toggleConv.png",alt:"OneBrain logo",width:40,height:40,onClick:h})}),(0,n.jsx)("div",{className:"app-select-switcher-bottom text-left",children:(0,n.jsx)(d(),{src:a?"/toggleAppSelClose.png":"/toggleAppSel.png",alt:"OneBrain logo",width:40,height:40,onClick:g})})]})},H=()=>{let e=(0,h.useRouter)(),t=(0,v.v9)(e=>e.chat_id),[s,o]=(0,l.useState)(null),a=(0,v.v9)(e=>e.changes_toggle),r=(0,g.parseCookies)(),i=r.access_token,c=async()=>{try{let e=await fetch("http://127.0.0.1:8080/chat/specific?chatid=".concat(t),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(i)},redirect:"follow"});if(e.ok){let t=await e.json();o(t),console.log(t)}else if(401===e.status)throw Error("Unauthorized");else throw Error("Network response was not OK")}catch(t){console.log("Error:",t),t instanceof Error&&"Unauthorized"===t.message?(console.log("Unauthorized error occurred"),u(e)):console.log("Error:",t)}};(0,l.useEffect)(()=>{t?(console.log("chatID"),console.log(t),c()):o(null)},[t,a]);let{isMobile:d}=m();return(0,n.jsx)(l.Fragment,{children:(0,n.jsx)("div",{id:"chat-screen",className:"chat-screen ".concat(d?"mobile":"desktop"),children:s&&s.UserQuestions&&s.MachineAnswers&&(0,n.jsx)(l.Fragment,{children:s.UserQuestions.map((e,t)=>(0,n.jsxs)(l.Fragment,{children:[(0,n.jsx)("div",{className:"question",children:e}),(0,n.jsx)("div",{className:"answer",children:s.MachineAnswers[t]})]},t))})})})},q=()=>{if("undefined"!=typeof document){let e=document.getElementsByTagName("textarea");for(let t=0;t<e.length;t++)e[t].setAttribute("style","height:"+(50+e[t].scrollHeight-50)+"px;overflow:auto;"),e[t].addEventListener("input",U,!1)}},U=e=>{let t=window.matchMedia("(max-width: 768px)").matches,s=document.getElementById("refresh-input");e.target.style.height=0,e.target.style.height=10+e.target.scrollHeight+"px",t?10+e.target.scrollHeight<240&&(s.style.top="".concat(-30-e.target.scrollHeight,"px")):10+e.target.scrollHeight<240&&(s.style.top="".concat(-10-e.target.scrollHeight,"px"))},I=()=>{console.log("performInput");let e=document.getElementById("chat-input");e&&(e.value="*",setTimeout(()=>{e.value=""},100),console.log("target set")),U({target:e})},P=e=>{let{changes_toggle:t,toggleChanges:s}=e,o=(0,v.v9)(e=>e.chat_id),a=(0,l.useRef)(null),r=(0,h.useRouter)(),[i,c]=(0,l.useState)("");(0,l.useEffect)(()=>{q();let e=e=>{console.log("Route change complete.")};return r.events.on("routeChangeComplete",e),()=>{r.events.off("routeChangeComplete",e)}},[r]),(0,l.useEffect)(()=>{I()},[]);let p=()=>{let e=(0,g.parseCookies)(),t=e.access_token,n=new Headers;n.append("Content-Type","application/json"),n.append("Authorization","Bearer ".concat(t));let l=JSON.stringify({title:"title",UserQuestions:i,MachineAnswers:"answer"});fetch("http://127.0.0.1:8080/chat/create",{method:"POST",headers:n,body:l,redirect:"follow"}).then(e=>e.text()).then(e=>{console.log(e),s()}).catch(e=>{e instanceof Error&&"401"===e.message?(console.log("Unauthorized error occurred"),u(r)):console.log("Error:",e)})},m=async()=>{let e=(0,g.parseCookies)(),t=e.access_token,n=new Headers;n.append("Content-Type","application/json"),n.append("Authorization","Bearer ".concat(t));let l=JSON.stringify({id:o,title:"test2",UserQuestions:i,MachineAnswers:"machine_answers"});try{let e=await fetch("http://127.0.0.1:8080/chat/append",{method:"POST",headers:n,body:l,redirect:"follow"});await e.json(),s()}catch(e){e instanceof Error&&"401"===e.message?(console.log("Unauthorized error occurred"),u(r)):console.log("Error:",e)}console.log("fetching end")},x=e=>{e.stopPropagation(),""!==i.trim()&&(null===o?p():m(),c(""),I()),console.log("chatId"),console.log(o)};return(0,n.jsxs)("div",{className:"chat-input",id:"input-container",children:[(0,n.jsxs)("div",{className:"refresh-input",id:"refresh-input",children:[(0,n.jsx)(f.G,{icon:y.lXL,size:"sm",style:{color:"#A2A2A5"}}),"Regenerate response"]}),(0,n.jsxs)("div",{className:"add-input",children:[(0,n.jsx)("textarea",{ref:a,id:"chat-input",placeholder:"Ask anything you need...",value:i,onChange:e=>c(e.target.value),onKeyDown:e=>{if("Enter"===e.key)return e.preventDefault(),x(e),!1}}),(0,n.jsx)(d(),{src:"/demoApp/paper-plane.png",alt:"OneBrain logo",width:38,height:38,onClick:e=>x(e)})]})]})},R=e=>({changes_toggle:e.changes_toggle}),F=e=>({toggleChanges:()=>e({type:"TOGGLE_CHANGES"})});var M=(0,v.$j)(R,F)(P);let K=e=>(0,n.jsx)(l.Fragment,{children:(0,n.jsxs)(v.zt,{store:B,children:[(0,n.jsx)(H,{}),(0,n.jsx)(M,{})]})}),Y=()=>(0,n.jsxs)(j,{children:[(0,n.jsx)(G,{}),(0,n.jsx)(K,{})]});var Q=Y}},function(e){e.O(0,[976,662,675,636,279,774,888,179],function(){return e(e.s=4313)}),_N_E=e.O()}]);