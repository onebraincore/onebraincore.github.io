(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[910],{4313:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/chatterbox",function(){return s(2154)}])},9852:function(e,t,s){"use strict";var n=s(5893);s(7294);let o=e=>{let{children:t}=e;return(0,n.jsx)("header",{children:t})};t.Z=o},2154:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return Z}});var n=s(5893),o=s(7294),a=s(9008),l=s.n(a),i=s(1664),r=s.n(i),c=s(5675),d=s.n(c),h=s(1163),p=s(2286),g=s(9852);let u=e=>{setTimeout(()=>(e.isReady&&setTimeout(()=>{e.push("/signin",void 0,{shallow:!1})},20),console.log("Unauthorized error"),Promise.reject("Unauthorized")),20)},m=()=>{let[e,t]=(0,o.useState)({isMobile:!1});return(0,o.useEffect)(()=>{let e=()=>{let e=window.matchMedia("(max-width: 810px)").matches;t({isMobile:e})};return window.addEventListener("resize",e),e(),()=>window.removeEventListener("resize",e)},[]),e};var x=s(2664);let j=()=>{"undefined"!=typeof document&&(0,p.setCookie)(null,"access_token","",{maxAge:-1,path:"/"})},v=e=>{let{app_theme_mod:t,children:s,headTitle:a,toggleAppThemeMod:i}=e,c=(0,h.useRouter)(),p=()=>{c.isReady&&setTimeout(()=>{c.push("/signin",void 0,{shallow:!1})},20)},u=async()=>{if(j(),t)try{i(),document.body.classList.remove("white")}catch(e){console.error(e)}p()},{isMobile:x}=m();return(0,n.jsxs)(o.Fragment,{children:[(0,n.jsxs)(l(),{children:[(0,n.jsx)("title",{children:a}),(0,n.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),(0,n.jsx)("link",{rel:"stylesheet",href:"/styles/htmlblackfix.css"})]}),(0,n.jsxs)(g.Z,{children:[(0,n.jsx)("div",{className:"container p-4-top onebrainapp",style:{display:"".concat(x?"none":"")},children:(0,n.jsx)("div",{className:"row-ordered",children:(0,n.jsxs)("div",{className:" col-lg-12 col-md-12 col-sm-12 col-xs-12 text-center",children:[(0,n.jsx)(r(),{href:"/",children:(0,n.jsxs)("div",{className:"brain-logo-sm",children:[t?(0,n.jsx)(d(),{src:"/smallWhiteBrainLogo.png",alt:"OneBrain logo",width:34,height:34}):(0,n.jsx)(d(),{src:"/brain-itself.gif",alt:"OneBrain logo",width:34,height:34}),(0,n.jsxs)("div",{className:"d-inline brand-name align-middle",children:[(0,n.jsx)("div",{className:"d-inline blue-gradient-brand-name",children:"One"}),(0,n.jsx)("div",{className:"d-inline violet-gradient-brand-name",children:"Brain"})]})]})}),(0,n.jsx)("div",{className:"d-inline absolute right-0 top-0",children:(0,n.jsx)(r(),{href:"#",children:(0,n.jsx)("span",{className:"book-a-call",onClick:u,children:"Log Out"})})})]})})}),x?(0,n.jsx)("div",{className:"logout-mobile-wrap",children:(0,n.jsx)("div",{className:"logout-mobile",onClick:u,children:"Log out"})}):""]}),(0,n.jsx)("div",{className:"".concat(x?"mobile":"desktop"),children:s})]})};v.defaultProps={headTitle:"OneBrain AI"};let y=e=>({app_theme_mod:e.app_theme_mod}),f=e=>({toggleAppThemeMod:()=>e({type:"TOGGLE_APP_THEME_MOD"})});var w=(0,x.$j)(y,f)(v),_=s(7814);s(3119);var E=s(9417);let N=e=>({type:"SET_CHATID",payload:e});var k=s(6486);let T=(0,n.jsx)(_.G,{icon:E.lXL,size:"sm"}),C=(0,n.jsx)(_.G,{icon:E.IwR,size:"sm",className:"pen-edit-icon"}),A=(0,n.jsx)(_.G,{icon:E.Vui,size:"sm",className:"pen-trash-icon"}),S=(0,n.jsx)(_.G,{icon:E.r8p,size:"sm",className:"icon"}),G=e=>{let{toggleChanges:t}=e,s=(0,h.useRouter)(),[a,l]=(0,o.useState)([]),[i,r]=(0,o.useState)({}),c=(0,x.I0)(),d=(0,x.v9)(e=>e.changes_toggle),g=(0,x.v9)(e=>e.chat_id);console.log("fetching server");let m=async()=>{let e=new Headers,t=(0,p.parseCookies)(),n=t.access_token;e.append("Content-Type","application/json"),e.append("Authorization","Bearer ".concat(n));try{let t=await fetch("http://127.0.0.1:8080/chat/titles",{method:"GET",headers:e,redirect:"follow"}),s=await t.json();l(s)}catch(e){e instanceof Error&&"401"===e.message?(console.log("Unauthorized error occurred"),u(s)):console.log("Error:",e)}console.log("fetching end")},j=e=>{let t={};return Array.isArray(e)&&e.forEach(e=>{t[e.id]=e.id}),t},v=(e,t)=>{(0,k.isEqual)(i,e)||t(e)};(0,o.useEffect)(()=>{m(),console.log("TOGGGGLLLLE");let e=j(a);v(e,e=>{})},[d]);let y=e=>{let n=(0,p.parseCookies)(),o=n.access_token,a=new Headers;a.append("Content-Type","application/json"),a.append("Authorization","Bearer ".concat(o)),fetch("http://127.0.0.1:8080/chat/delete?id=".concat(e),{method:"GET",headers:a,redirect:"follow"}).then(e=>{if(!e.ok)throw Error(e.status.toString());return e.text()}).then(e=>{console.log(e),t(),c(N(null))}).catch(e=>{e instanceof Error&&"401"===e.message?(console.log("Unauthorized error occurred"),u(s)):console.log("Error:",e)})},f=()=>{let e=document.querySelector("#chat-input");e&&e.focus(),c(N(null))},w=(()=>{let e={today:[],last7Days:[],last30Days:[],lastYear:[]},t=new Date;t.setDate(t.getDate()-1);let s=new Date(t);s.setDate(s.getDate()-7);let n=new Date(t);n.setDate(n.getDate()-30);let o=new Date(t);return o.setFullYear(o.getFullYear()-1),Array.isArray(a)&&a.forEach(a=>{let l=new Date(a.createdat);l>=s?e.today.push(a):l>=s?e.last7Days.push(a):l>=n&&l<=t?e.last30Days.push(a):l>=o&&l<=t&&e.lastYear.push(a)}),e})(),_=e=>{var t,s;let n=null===(t=e.currentTarget.closest(".old-chat"))||void 0===t?void 0:t.querySelector("input");if(e.stopPropagation(),n){n.focus();let e=null===(s=n.closest(".old-chat"))||void 0===s?void 0:s.querySelector(".delete-edit-hover");e&&(e.style.display="none")}},E=async e=>{try{y(e)}catch(e){console.log("Error occurred while deleting chat:",e)}},G=(e,t)=>{var s;null===(s=e.currentTarget.closest(".old-chat"))||void 0===s||s.querySelector("input"),e.stopPropagation(),E(t)},b=(e,t)=>{var s;let n=null===(s=e.currentTarget.closest(".old-chat"))||void 0===s?void 0:s.querySelector(".delete-edit-hover");n&&(n.style.display="block");let o=e.currentTarget.value,a=i[t];if(o!==a){let e=(0,p.parseCookies)(),s=e.access_token,n=new Headers;n.append("Content-Type","application/json"),n.append("Authorization","Bearer ".concat(s));let a=JSON.stringify({id:t,title:o});fetch("http://127.0.0.1:8080/chat/edit_title",{method:"POST",headers:n,body:a,redirect:"follow"}).then(e=>e.text()).then(e=>console.log(e)).catch(e=>console.log("error",e))}"Enter"===e.key&&e.currentTarget.blur()},L=(e,t)=>{t.stopPropagation(),console.log("Clicked on delete/edit with chatId:",e),c(N(e))};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"new-chat ".concat(null===g?"active":""),onClick:f,children:[S,"New chat"]}),(0,n.jsxs)("div",{className:"chat-nav-records",children:[(0,n.jsxs)("div",{className:"timeblock",children:[(0,n.jsx)("div",{className:"timestamp text-left",children:"Today"}),w.today.map(e=>(0,n.jsxs)("div",{className:"old-chat ".concat(g===e.id?"active":""),children:[(0,n.jsx)("input",{type:"text",defaultValue:e.title,onBlur:t=>b(t,e.id),onKeyDown:t=>{"Enter"===t.key&&b(t,e.id)}}),T,(0,n.jsxs)("div",{className:"delete-edit-hover",onClick:t=>L(e.id,t),children:[(0,n.jsx)("div",{className:"wrapping",onClick:e=>_(e),children:C}),(0,n.jsx)("div",{className:"wrapping",onClick:t=>G(t,e.id),children:A})]})]},e.id))]}),(0,n.jsxs)("div",{className:"timeblock",children:[(0,n.jsx)("div",{className:"timestamp text-left",children:"Last 7 days"}),w.last7Days.map(e=>(0,n.jsxs)("div",{className:"old-chat ".concat(g===e.id?"active":""),children:[(0,n.jsx)("input",{type:"text",defaultValue:e.title,onBlur:t=>b(t,e.id),onKeyDown:t=>{"Enter"===t.key&&b(t,e.id)}}),T,(0,n.jsxs)("div",{className:"delete-edit-hover",onClick:t=>L(e.id,t),children:[(0,n.jsx)("div",{className:"wrapping",onClick:e=>_(e),children:C}),(0,n.jsx)("div",{className:"wrapping",onClick:t=>G(t,e.id),children:A})]})]},e.id))]}),(0,n.jsxs)("div",{className:"timeblock",children:[(0,n.jsx)("div",{className:"timestamp text-left",children:"Last 30 days"}),w.last30Days.map(e=>(0,n.jsxs)("div",{className:"old-chat",children:[(0,n.jsx)("input",{type:"text",defaultValue:e.title,onBlur:t=>b(t,e.id),onKeyDown:t=>{"Enter"===t.key&&b(t,e.id)}}),T,(0,n.jsxs)("div",{className:"delete-edit-hover",onClick:t=>L(e.id,t),children:[(0,n.jsx)("div",{className:"wrapping",id:"editTitle",onClick:e=>_(e),children:C}),A]})]},e._id))]}),(0,n.jsxs)("div",{className:"timeblock",children:[(0,n.jsx)("div",{className:"timestamp text-left",children:"Last year"}),w.lastYear.map(e=>(0,n.jsxs)("div",{className:"old-chat",children:[(0,n.jsx)("input",{type:"text",defaultValue:e.title,onBlur:t=>b(t,e.id),onKeyDown:t=>{"Enter"===t.key&&b(t,e.id)}}),T," ",e.title,(0,n.jsxs)("div",{className:"delete-edit-hover",onClick:t=>L(e.id,t),children:[(0,n.jsx)("div",{className:"wrapping",id:"editTitle",onClick:e=>_(e),children:C}),A]})]},e._id))]})]})]})},b=e=>({changes_toggle:e.changes_toggle}),L=e=>({toggleChanges:()=>e({type:"TOGGLE_CHANGES"})});var O=(0,x.$j)(b,L)(G);let D=()=>(0,n.jsxs)("div",{className:"select-app-container",children:[(0,n.jsx)(d(),{src:"/demoApp/selectApps/g-drive.png",alt:"OneBrain logo",width:187,height:156}),(0,n.jsx)(d(),{src:"/demoApp/selectApps/slack.png",alt:"OneBrain logo",width:187,height:156}),(0,n.jsx)(d(),{src:"/demoApp/selectApps/add-app.png",alt:"OneBrain logo",width:187,height:156})]});var z=s(8356),B=s(8500);let R={chat_id:null,changes_toggle:!1,app_theme_mod:!1,regenerate_resp:!1,send_request_waiting:!1},q=(0,z.MT)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:R,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_CHATID":return{...e,chat_id:t.payload};case"TOGGLE_CHANGES":return{...e,changes_toggle:!e.changes_toggle};case"TOGGLE_APP_THEME_MOD":return{...e,app_theme_mod:!e.app_theme_mod};case"TOGGLE_REGENERATE_RESP":return{...e,regenerate_resp:!e.regenerate_resp};case"TOGGLE_SEND_REQUEST_WAITING":return{...e,send_request_waiting:!e.send_request_waiting};default:return e}},(0,B.Uo)((0,z.md)())),P=e=>{let{app_theme_mod:t,toggleAppThemeMod:s}=e,[a,l]=(0,o.useState)(!1),[i,r]=(0,o.useState)(!1),[c,h]=(0,o.useState)(!1),{isMobile:p}=m();(0,o.useEffect)(()=>{s(),document.body.classList.add("white")},[]);let g=()=>{l(!a)},u=()=>{if(!c){let e=document.querySelector("#chat-screen"),t=document.querySelector("#input-container"),s=document.querySelector("#refresh-input"),n=document.querySelector("#chat-input");e&&(e.classList.toggle("hidden"),s.classList.toggle("hidden"),n.classList.toggle("hidden"),t.classList.toggle("hidden")),r(!i)}},j=()=>{if(!i){let e=document.querySelector("#chat-screen"),t=document.querySelector("#input-container"),s=document.querySelector("#refresh-input"),n=document.querySelector("#chat-input");e&&(e.classList.toggle("hidden"),s.classList.toggle("hidden"),n.classList.toggle("hidden"),t.classList.toggle("hidden")),h(!c)}},v=()=>{event.stopPropagation(),s(),t?document.body.classList.remove("white"):document.body.classList.add("white")};return(0,n.jsxs)("div",{className:"chat-navigation",style:!p||i||c?{}:{top:"auto",height:"110px",bottom:"-40px",paddingTop:"0px",zIndex:1,position:"fixed"},children:[(0,n.jsx)("div",{className:"app-select-switcher text-left",children:(0,n.jsx)(d(),{src:t?a?"/toggleAppSelInvert.png":"/toggleConvInvert.png":a?"/toggleAppSel.png":"/toggleConv.png",alt:"OneBrain logo",width:40,height:40,onClick:g})}),(0,n.jsx)("div",{className:"color-scheme-switcher",children:t?(0,n.jsx)(_.G,{icon:E.DBF,size:"2xl",style:{color:"#828282"},onClick:v}):(0,n.jsx)(_.G,{icon:E.enB,size:"2xl",style:{color:"#FCFDFC"},onClick:v})}),a||p?a&&!p?(0,n.jsx)(D,{}):!i&&c&&p?(0,n.jsx)(D,{}):!c&&i&&p?(0,n.jsx)(x.zt,{store:q,children:(0,n.jsx)(O,{})}):p?(0,n.jsx)("div",{style:{backgroundColor:"black"}}):(0,n.jsx)(D,{}):(0,n.jsx)(x.zt,{store:q,children:(0,n.jsx)(O,{})}),(0,n.jsx)("div",{className:"chat-records-switcher-bottom text-left",children:(0,n.jsx)(d(),{src:i?"/toggleAppSelClose.png":"/toggleConv.png",alt:"OneBrain logo",width:40,height:40,onClick:u})}),(0,n.jsx)("div",{className:"app-select-switcher-bottom text-left",children:(0,n.jsx)(d(),{src:c?"/toggleAppSelClose.png":"/toggleAppSel.png",alt:"OneBrain logo",width:40,height:40,onClick:j})})]})},H=e=>({app_theme_mod:e.app_theme_mod}),I=e=>({toggleAppThemeMod:()=>e({type:"TOGGLE_APP_THEME_MOD"})});var M=(0,x.$j)(H,I)(P);let U=()=>{let e=(0,h.useRouter)(),t=(0,x.v9)(e=>e.chat_id),[s,a]=(0,o.useState)(null),l=(0,x.v9)(e=>e.changes_toggle),i=(0,p.parseCookies)(),r=i.access_token,c=async()=>{try{let e=await fetch("http://127.0.0.1:8080/chat/specific?chatid=".concat(t),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)},redirect:"follow"});if(e.ok){let t=await e.json();a(t),console.log(t)}else if(401===e.status)throw Error("Unauthorized");else throw Error("Network response was not OK")}catch(t){console.log("Error:",t),t instanceof Error&&"Unauthorized"===t.message?(console.log("Unauthorized error occurred"),u(e)):console.log("Error:",t)}};(0,o.useEffect)(()=>{t?(console.log("chatID"),console.log(t),c()):a(null)},[t,l]);let{isMobile:d}=m();return(0,n.jsx)(o.Fragment,{children:(0,n.jsx)("div",{id:"chat-screen",className:"chat-screen ".concat(d?"mobile":"desktop"),children:s&&s.UserQuestions&&s.MachineAnswers&&(0,n.jsx)(o.Fragment,{children:s.UserQuestions.map((e,t)=>(0,n.jsxs)(o.Fragment,{children:[(0,n.jsx)("div",{className:"question",children:e}),(0,n.jsx)("div",{className:"answer",children:s.MachineAnswers[t]})]},t))})})})},F=()=>{if("undefined"!=typeof document){let e=document.getElementsByTagName("textarea");for(let t=0;t<e.length;t++)e[t].setAttribute("style","height:"+(50+e[t].scrollHeight-50)+"px;overflow:auto;"),e[t].addEventListener("input",K,!1)}},K=e=>{let t=window.matchMedia("(max-width: 810px)").matches,s=document.getElementById("refresh-input");e.target.style.height=0,e.target.style.height=10+e.target.scrollHeight+"px",t?10+e.target.scrollHeight<240&&(s.style.top="".concat(-30-e.target.scrollHeight,"px")):10+e.target.scrollHeight<240&&(s.style.top="".concat(-10-e.target.scrollHeight,"px"))},Q=()=>{console.log("performInput");let e=document.getElementById("chat-input");e&&(e.value="*",setTimeout(()=>{e.value=""},100),console.log("target set")),K({target:e})},V=e=>{let{app_theme_mod:t,changes_toggle:s,regenerate_resp:a,send_request_waiting:l,toggleChanges:i,toggleRegenerateResp:r,toggleSendRequestWaiting:c}=e,{isMobile:g}=m(),j=(0,x.v9)(e=>e.chat_id),v=(0,o.useRef)(null),y=(0,h.useRouter)(),[f,w]=(0,o.useState)("");(0,o.useEffect)(()=>{F();let e=e=>{console.log("Route change complete.")};return y.events.on("routeChangeComplete",e),()=>{y.events.off("routeChangeComplete",e)}},[y]),(0,o.useEffect)(()=>{Q()},[]);let N=()=>{let e=(0,p.parseCookies)(),t=e.access_token,s=new Headers;s.append("Content-Type","application/json"),s.append("Authorization","Bearer ".concat(t));let n=JSON.stringify({title:"title",UserQuestions:f,MachineAnswers:"answer"});fetch("http://127.0.0.1:8080/chat/create",{method:"POST",headers:s,body:n,redirect:"follow"}).then(e=>e.text()).then(e=>{console.log(e),i()}).catch(e=>{e instanceof Error&&"401"===e.message?(console.log("Unauthorized error occurred"),u(y)):console.log("Error:",e)})},k=async()=>{let e=(0,p.parseCookies)(),t=e.access_token,s=new Headers;s.append("Content-Type","application/json"),s.append("Authorization","Bearer ".concat(t));let n=JSON.stringify({id:j,title:"test2",UserQuestions:f,MachineAnswers:"machine_answers"}),o={method:"POST",headers:s,body:n,redirect:"follow"};c();try{setTimeout(async()=>{let e=await fetch("http://127.0.0.1:8080/chat/append",o);await e.json(),i(),c()},0)}catch(e){e instanceof Error&&"401"===e.message?(console.log("Unauthorized error occurred"),u(y)):console.log("Error:",e)}console.log("fetching end")},T=e=>{e.stopPropagation(),""!==f.trim()&&(null===j?N():k(),w(""),Q())},C=e=>{let{value:t}=e.target;t.length<=220&&w(t)};return(0,n.jsxs)("div",{className:"chat-input",id:"input-container",children:[(0,n.jsxs)("div",{className:"refresh-input",id:"refresh-input",children:[a?(0,n.jsx)(_.G,{icon:E.T80,size:"lg"}):(0,n.jsx)(_.G,{icon:E.lXL,size:"sm"}),g?"Regenerate":"Regenerate response"]}),(0,n.jsxs)("div",{className:"add-input",children:[(0,n.jsx)("textarea",{ref:v,id:"chat-input",placeholder:"Ask anything you need...",value:f,onChange:C,onKeyDown:e=>{if("Enter"===e.key)return e.preventDefault(),T(e),!1}}),t?l?(0,n.jsx)(_.G,{icon:E.T80,size:"lg"}):(0,n.jsx)(d(),{src:"/demoApp/paper-plane-black.png",alt:"OneBrain logo",width:38,height:38,onClick:e=>T(e)}):l?(0,n.jsx)(_.G,{icon:E.T80,size:"lg"}):(0,n.jsx)(d(),{src:"/demoApp/paper-plane.png",alt:"Other logo",width:38,height:38,onClick:e=>T(e)})]})]})},Y=e=>({changes_toggle:e.changes_toggle,app_theme_mod:e.app_theme_mod,regenerate_resp:e.regenerate_resp,send_request_waiting:e.send_request_waiting}),W=e=>({toggleChanges:()=>e({type:"TOGGLE_CHANGES"}),toggleRegenerateResp:()=>e({type:"TOGGLE_REGENERATE_RESP"}),toggleSendRequestWaiting:()=>e({type:"TOGGLE_SEND_REQUEST_WAITING"})});var X=(0,x.$j)(Y,W)(V);let $=e=>(0,n.jsx)(o.Fragment,{children:(0,n.jsxs)(x.zt,{store:q,children:[(0,n.jsx)(U,{}),(0,n.jsx)(X,{})]})}),J=()=>(0,n.jsx)(x.zt,{store:q,children:(0,n.jsxs)(w,{children:[(0,n.jsx)(M,{}),(0,n.jsx)($,{})]})});var Z=J}},function(e){e.O(0,[976,662,675,636,279,774,888,179],function(){return e(e.s=4313)}),_N_E=e.O()}]);